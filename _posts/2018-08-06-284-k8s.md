---
layout: post
title: K8s尝试
pid: 284
tags: [centos, k8s, docker]
---

[root@iZ2ze8loow3hbkxeskzsucZ ~]# cd /usr/local/
[root@iZ2ze8loow3hbkxeskzsucZ local]# git clone https://github.com/rinormaloku/k8s-mastery.git

# SA-FRONTEND

[root@iZ2ze8loow3hbkxeskzsucZ local]# cd k8s-mastery/sa-frontend/
[root@iZ2ze8loow3hbkxeskzsucZ sa-frontend]# npm install
[root@iZ2ze8loow3hbkxeskzsucZ sa-frontend]# npm start
[root@iZ2ze8loow3hbkxeskzsucZ sa-frontend]# npm run build
[root@iZ2ze8loow3hbkxeskzsucZ sa-frontend]# cd build/
[root@iZ2ze8loow3hbkxeskzsucZ build]# pwd
/usr/local/k8s-mastery/sa-frontend/build
[root@iZ2ze8loow3hbkxeskzsucZ build]# vim /etc/nginx/conf.d/default.conf

location / {
	#root   /usr/share/nginx/html;
	root   /usr/local/k8s-mastery/sa-frontend/build;
	index  index.html index.htm;
}

http://47.93.14.139/



# SA-WEBAPP

[root@iZ2ze8loow3hbkxeskzsucZ ~]# cd /usr/local/k8s-mastery/sa-webapp/
[root@iZ2ze8loow3hbkxeskzsucZ sa-webapp]# yum install maven
[root@iZ2ze8loow3hbkxeskzsucZ sa-webapp]# mvn install
[root@iZ2ze8loow3hbkxeskzsucZ sa-webapp]# cd target/
[root@iZ2ze8loow3hbkxeskzsucZ target]# java -jar sentiment-analysis-web-0.0.1-SNAPSHOT.jar --sa.logic.api.url=http://localhost:5000
[root@iZ2ze8loow3hbkxeskzsucZ ~]# cd /usr/local/k8s-mastery/sa-logic/



# SA-LOGIC

[root@iZ2ze8loow3hbkxeskzsucZ sa-logic]# cd sa/
[root@iZ2ze8loow3hbkxeskzsucZ sa]# python -m pip install -r requirements.txt 
[root@iZ2ze8loow3hbkxeskzsucZ sa]# python -m textblob.download_corpora
[root@iZ2ze8loow3hbkxeskzsucZ sa]# python sentiment_analysis.py 

以上三个地方的配置，在联合调试的时候，需要做一些灵活的思考和修改。


# INSTALL DOCKER CE

[root@iZ2ze8loow3hbkxeskzsucZ ~]# yum install -y yum-utils device-mapper-persistent-data lvm2
[root@iZ2ze8loow3hbkxeskzsucZ ~]# yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
[root@iZ2ze8loow3hbkxeskzsucZ ~]# yum install docker-ce
[root@iZ2ze8loow3hbkxeskzsucZ ~]# systemctl start docker
[root@iZ2ze8loow3hbkxeskzsucZ ~]# docker run hello-world


# RUN DOCKER
[root@iZ2ze8loow3hbkxeskzsucZ ~]# docker login -u="username" -p="password"
[root@iZ2ze8loow3hbkxeskzsucZ ~]# cd /usr/local/k8s-mastery/sa-frontend/
[root@iZ2ze8loow3hbkxeskzsucZ sa-frontend]# docker build -f Dockerfile -t baoguoding/sentiment-analysis-fronted .
[root@iZ2ze8loow3hbkxeskzsucZ sa-frontend]# docker push baoguoding/sentiment-analysis-fronted
[root@iZ2ze8loow3hbkxeskzsucZ sa-frontend]# docker pull baoguoding/sentiment-analysis-fronted
[root@iZ2ze8loow3hbkxeskzsucZ sa-frontend]# docker run -d -p 80:80 baoguoding/sentiment-analysis-fronted

[root@iZ2ze8loow3hbkxeskzsucZ sa-frontend]# cd ../sa-webapp/
[root@iZ2ze8loow3hbkxeskzsucZ sa-webapp]# docker build -f Dockerfile -t baoguoding/sentiment-analysis-web-app .
[root@iZ2ze8loow3hbkxeskzsucZ sa-webapp]# docker run -d -p 8080:8080 -e SA_LOGIC_API_URL='http://47.93.14.139:5050' baoguoding/sentiment-analysis-web-app

[root@iZ2ze8loow3hbkxeskzsucZ sa-webapp]# cd ../sa-logic/
[root@iZ2ze8loow3hbkxeskzsucZ sa-logic]# docker build -f Dockerfile -t baoguoding/sentiment-analysis-logic .
[root@iZ2ze8loow3hbkxeskzsucZ sa-logic]# docker run -d -p 5050:5000 baoguoding/sentiment-analysis-logic


# INSTALL VirtualBox

[root@iz2ze8loow3hbkxeskzsucz ~]# cd /etc/yum.repos.d
[root@iz2ze8loow3hbkxeskzsucz yum.repos.d]# wget http://download.virtualbox.org/virtualbox/rpm/rhel/virtualbox.repo


[root@iz2ze8loow3hbkxeskzsucz ~]# yum install VirtualBox-5.2



# Install Kubectl

cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF
yum install -y kubectl

curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.8.0/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/



# Install MINIKUBE

curl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v0.24.1/minikube-linux-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/

# RUN MINIKUBE
[root@iz2ze8loow3hbkxeskzsucz ~]# service docker start
[root@iz2ze8loow3hbkxeskzsucz ~]# export CHANGE_MINIKUBE_NONE_USER=true
[root@iz2ze8loow3hbkxeskzsucz ~]# minikube start --vm-driver=none --bootstrapper=localkube
[root@iz2ze8loow3hbkxeskzsucz ~]# minikube status
[root@iz2ze8loow3hbkxeskzsucz ~]# kubectl get nodes

[root@iz2ze8loow3hbkxeskzsucz ~]# journalctl -fu kubelet ---查看问题
[root@iz2ze8loow3hbkxeskzsucz ~]# minikube logs -f
[root@iz2ze8loow3hbkxeskzsucz ~]# docker rm -f $(docker ps -aq --filter name=k8s)
[root@iz2ze8loow3hbkxeskzsucz ~]# minikube stop
[root@iz2ze8loow3hbkxeskzsucz ~]# minikube delete
[root@iz2ze8loow3hbkxeskzsucz ~]# rm -rf ~/.minikube



# 参考

[三小时学会Kubernetes：容器编排详细指南](http://dockone.io/article/5132)

[Get Docker CE for CentOS](https://docs.docker.com/install/linux/docker-ce/centos/)

[安装Docker CE、安装最新版Docker](https://blog.csdn.net/chen798213337/article/details/78228299)

[Install Minikube](https://kubernetes.io/docs/tasks/tools/install-minikube/)

[Kubernetes 学习笔记之 MiniKube 安装](https://ehlxr.me/2018/01/12/kubernetes-minikube-installation/)

[Minikube - Kubernetes本地实验环境](https://yq.aliyun.com/articles/221687)


[Day 1 前言 & 介紹Kubernetes](https://ithelp.ithome.com.tw/articles/10192401)


[部署node节点](https://jimmysong.io/kubernetes-handbook/practice/node-installation.html)

[在CentOS7上使用二进制方式部署Kubernetes](https://o-my-chenjian.com/2017/04/25/Deploy-K8s-By-Source-Code-On-CentOS7/)
